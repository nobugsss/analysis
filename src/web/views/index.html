<!--
 * @Author: boykaaa
 * @Date: 2025-10-16 11:48:53
 * @LastEditors: boykaaa
 * @LastEditTime: 2025-10-16 11:53:39
 * @description: 
 * @param: 
 * @return: 
-->
<!doctype html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>IP日志地图可视化</title>
		<link rel="stylesheet" href="style.css" />
	</head>
	<body>
		<div class="container">
			<header>
				<h1>IP日志地图可视化</h1>
				<div class="controls">
					<input type="file" id="fileInput" accept=".json" />
					<button id="loadBtn">加载数据</button>
					<button id="clearBtn">清除数据</button>
				</div>
			</header>

			<div class="stats-panel">
				<div class="stat-item">
					<span class="stat-label">总IP数:</span>
					<span class="stat-value" id="totalIps">0</span>
				</div>
				<div class="stat-item">
					<span class="stat-label">总请求数:</span>
					<span class="stat-value" id="totalRequests">0</span>
				</div>
				<div class="stat-item">
					<span class="stat-label">区域数:</span>
					<span class="stat-value" id="totalRegions">0</span>
				</div>
			</div>

			<div class="map-container">
				<div id="map"></div>
			</div>

			<div class="details-panel">
				<h3>IP详情</h3>
				<div id="ipDetails"></div>
			</div>
		</div>

		<!-- Google Maps API - 动态加载 -->
		<script>
			// 动态加载Google Maps API
			async function loadGoogleMapsAPI() {
				try {
					const response = await fetch("/api/google-maps-key");
					const data = await response.json();

					if (data.apiKey && data.apiKey !== "YOUR_API_KEY") {
						const script = document.createElement("script");
						script.src = `https://maps.googleapis.com/maps/api/js?key=${data.apiKey}&callback=initMap`;
						script.async = true;
						script.defer = true;
						document.head.appendChild(script);
					} else {
						document.getElementById("map").innerHTML = `
							<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f5f5f5; color: #666;">
								<div style="text-align: center;">
									<h3>Google Maps API密钥未配置</h3>
									<p>请按照以下步骤配置API密钥：</p>
									<ol style="text-align: left; display: inline-block;">
										<li>访问 <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
										<li>创建或选择一个项目</li>
										<li>启用Maps JavaScript API</li>
										<li>创建API密钥</li>
										<li>设置环境变量 GOOGLE_MAPS_API_KEY</li>
									</ol>
								</div>
							</div>
						`;
					}
				} catch (error) {
					console.error("加载Google Maps API失败:", error);
					document.getElementById("map").innerHTML = `
						<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f5f5f5; color: #d32f2f;">
							<div style="text-align: center;">
								<h3>加载Google Maps失败</h3>
								<p>请检查网络连接和API密钥配置</p>
							</div>
						</div>
					`;
				}
			}

			// 页面加载完成后加载Google Maps API
			document.addEventListener("DOMContentLoaded", loadGoogleMapsAPI);
		</script>
		<script src="script.js"></script>
	</body>
</html>
